#map
:javascript
  function pinSymbolCar(color) {
      return {
          path: 'M 0,0 C -2,-20 -10,-22 -10,-30 A 10,10 0 1,1 10,-30 C 10,-22 2,-20 0,0 z M -2,-30 a 2,2 0 1,1 4,0 2,2 0 1,1 -4,0',
          fillColor: color,
          fillOpacity: 1,
          strokeColor: '#000',
          strokeWeight: 2,
          scale: 1,
     };
   }

  function initMap() {
     var map = new google.maps.Map(document.getElementById('map'), {
       zoom: 14,
       center: {"lat": #{params[:lat]}, "lng": #{params[:lng]} },
       gestureHandling: 'greedy',
       mapTypeControl: false,
       streetViewControl: false,
       zoomControl: true,
       zoomControlOptions: {
         position: google.maps.ControlPosition.TOP_LEFT
       }
     });

     var content = "Current Location<br>"+
                   "<button onclick='getLocation()'>Update</button>"+
                   "<img id='spinner' src='/images/spinner.gif' "+
                   "style='display: none;'/>";

     var yourinfo = new google.maps.InfoWindow({
       content: content
     });

     var youmarker = new google.maps.Marker({
       position: {"lat": #{params[:lat]}, "lng": #{params[:lng]} },
       map: map,
       title: "You",
       icon: pinSymbolCar('#2f2')
     });

     youmarker.addListener('click', function() {
       yourinfo.open(map, youmarker);
     });

     addCar0(map);
     addCar1(map);
     addCar2(map);
  }

- @results.each_with_index do |(car, fs), idx|
  :javascript
    function addCar#{idx}(map){

       var fs0marker = new google.maps.Marker({
         position: #{fs[0].json_location},
         map: map,
         icon: "#{fs[0].marker_icon}",
         title: "#{fs[0].name}"
       });

       var fs0info = new google.maps.InfoWindow({
         content: "#{fs[0].details}"
       });

       fs0marker.addListener("click", function(){
         fs0info.open(map, fs0marker);
       });

       var fs1marker = new google.maps.Marker({
         position: #{fs[1].json_location},
         map: map,
         icon: "#{fs[1].marker_icon}",
         title: "#{fs[1].name}"
       });

       var fs1info = new google.maps.InfoWindow({
         content: "#{fs[1].details}"
       });

       fs1marker.addListener("click", function(){
         fs1info.open(map, fs1marker);
       });


       var fs2marker = new google.maps.Marker({
         position: #{fs[2].json_location},
         map: map,
         icon: "#{fs[2].marker_icon}",
         title: "#{fs[2].name}"
       });

       var fs2info = new google.maps.InfoWindow({
         content: "#{fs[2].details}"
       });

       fs2marker.addListener("click", function(){
         fs2info.open(map, fs2marker);
       });


       var carmarker = new google.maps.Marker({
         position: #{car.json_location},
         map: map,
         title: "#{car.name}",
         icon: "#{car.marker_icon}"
       });

       var infowindow = new google.maps.InfoWindow({
         content: "#{car.details}"
       });

       carmarker.addListener('click', function(){
          infowindow.open(map, carmarker);
       });
      }

%script{:async => "", :defer => "defer", :src => "https://maps.googleapis.com/maps/api/js?key=#{ENV['GOOGLE_API_KEY']}&callback=initMap"}

#demo

%form#location{ :method => "post", :action => "/cars" }
  %input#lat{ :type => "hidden", :name => "lat", :value => "0" }
  %input#lng{ :type => "hidden", :name => "lng", :value => "0" }

:javascript
  function getLocation() {
    $('#spinner').show();
    if (navigator.geolocation) {
       navigator.geolocation.getCurrentPosition(showPosition);
    } else {
       $('#demo').html("Geolocation is not supported by this browser.");
    }
  }
  function showPosition(position) {
    $('#spinner').hide();
    $("#lat").attr('value', position.coords.latitude);
    $("#lng").attr('value', position.coords.longitude);
    $("#location").submit();
  }
